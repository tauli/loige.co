{"data":{"site":{"siteMetadata":{"title":"Luciano Mammino \"Loige\" - Web developer, entrepreneur, fighter, butterfly maker!","author":"Luciano Mammino","siteUrl":"https://loige.co/","twitterProfile":"loige","disqusShortName":"loige"}},"markdownRemark":{"id":"75e05126-88e8-5d95-b21c-ed4aa43ed66c","timeToRead":6,"headings":[{"value":"Introduction","depth":2},{"value":"Track email opening","depth":2},{"value":"Symfony implementation","depth":2},{"value":"Improve performance","depth":3},{"value":"Considerations","depth":2}],"html":"<p>If you have ever heard about ”<strong>transparent pixel</strong>”, ”<strong>1x1 blank pixel</strong>”, ”<strong>tracking pixel</strong>” or simply ”<strong>tracking image</strong>” you probably know what we are going to talk about and can just <a href=\"#symfonyimplementation\">skip to the implementation</a>!</p>\n<h2 id=\"introduction\"><a href=\"#introduction\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>Transparent pixel image is a technique often used to track some user behavior (often visits or views to a certain online content) in scenarios where you can’t use javascript.</p>\n<p>One of the most common scenarios is probably email opening tracking. Can you put Google Analytics into an email? Well, probably it would not work as expected… So there’s something we can do? Of course there is, let’s jump into a concrete example.</p>\n<h2 id=\"track-email-opening\"><a href=\"#track-email-opening\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Track email opening</h2>\n<p>The following image shows the typical tracking flow applied to emails:</p>\n<p>\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; ; max-width: 900px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 58.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACoklEQVQozyWSyW/TUBDGcweEhFjKf4A4IA4IVSBaKoRYLlwR4sKdA73AtTe4IBClK7SVaCEtatVFqG1IGuImtZOmcRbHiWM7iRPbz7HjhsZNvWQzz2H09DRz+M375pvnYhSTlk1GsVi1zSitynFXrHfyahuWtGyxikVJjWCy4N2ndqKUc+9n/FEKSRRY2XD9JzOi5ovRYZI7yOZRktuJM94YHckrWdkoVI10XsJSHJpkAziL4MyfGBPA8xRouJgeTEraHltCWTHKlSJFIVIEIUbEioBVj2zbTvIMXmZgImrttNRiqm1agbpMB3a0yRZTbeFlg6pY4Kjry+RH1pY+en5CgKmUZpFVN7pZUARYFlUzyZ9kgZ6rQNmgHkqVgikuTAECmIVqN8gUZ3a9CC3inMSpYBZZ/7D9Yz2O/NUbtt2VtWasdEJVHKdco5Mz09/ck3MLX+cXYTL3feX1+7eeRJar2YVqJwv436m9kgoOTa1makbbKNesBA9hw4EHB+8MD78KBvcQNBxAwziemJqa3ESixSOb4I8XUKRc082O3ex064Zd07tUpZnkdQiziumCcfbchev99x89efrsxcurN4auXOv3YYmyZh+UlXH/VjQno6SwS/AhEgQIYTcNx6mTkpmVDNfQ3cGbtwY+jY6Hlpd/uRf8WGRiYub5uzcjG/NbVIYQVB9GeNAUmpUOaDmck4OZSozTCNEgBN31Px4/fLC2vT29uBTBsLGxzxMrGzHhkJHhYAZbdbzJyU1aaZGSRQArKRgJXs8AwyHPX+y7PXCv79LlL0ueFX98MxinJbOgdnMVk3UW6cBZYGSAToo63FOc15OCnhJ7L586fca9vrPqxaJsjavbUgO6oqfFE9gbkvmqBbuQAH4Bk5KMlNAje+cf8wc5JaIzlyAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <picture>\n        <source\n          srcset=\"/static/email-tracking-567d4c104c05a115bb3ce91f0ba2bf7e-96960.webp 256w,\n/static/email-tracking-567d4c104c05a115bb3ce91f0ba2bf7e-1dea6.webp 512w,\n/static/email-tracking-567d4c104c05a115bb3ce91f0ba2bf7e-8ba95.webp 900w\"\n          sizes=\"(max-width: 900px) 100vw, 900px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/email-tracking-567d4c104c05a115bb3ce91f0ba2bf7e-761f6.png 256w,\n/static/email-tracking-567d4c104c05a115bb3ce91f0ba2bf7e-3d429.png 512w,\n/static/email-tracking-567d4c104c05a115bb3ce91f0ba2bf7e-43ac5.png 900w\"\n          sizes=\"(max-width: 900px) 100vw, 900px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n          src=\"/static/email-tracking-567d4c104c05a115bb3ce91f0ba2bf7e-43ac5.png\"\n          alt=\"Tracking email opening\"\n          title=\"\"\n          src=\"/static/email-tracking-567d4c104c05a115bb3ce91f0ba2bf7e-43ac5.png\"\n        />\n      </picture>\n      </span>\n  </span>\n  </p>\n<ol>\n<li>\n<p>A user receives our HTML email. Within the email content there’s a “smart” tracking image: <code class=\"language-text\">&lt;img src=&quot;http://example.com/track.gif?id=1234&quot;&gt;</code>. Notice that it points to our server <strong>example.com</strong> and has a parameter <code class=\"language-text\">id=1234</code>.</p>\n</li>\n<li>\n<p>When the user opens the email, his email client will start to download all the resources linked into the HTML code (usually images) and it will trigger a request to download the tracking image.</p>\n</li>\n<li>\n<p>The request is handled by the <strong>example.com</strong> webserver. It does not handle the request as a static image but it executes some logic. It checks the <code class=\"language-text\">id</code> parameter and uses it to determine which email has triggered the request. Then it marks that email as opened in its own database for future reports. The mail client is still waiting for an answer and it expects an image. So the webserver generates on the fly the most small image possible: a 1x1 transparent image!</p>\n</li>\n<li>\n<p>Then the image is sent back to the client that will render it on the screen. Anyway the image is trasparent and so small that the user will barely notice it.</p>\n</li>\n</ol>\n<h2 id=\"symfony-implementation\"><a href=\"#symfony-implementation\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Symfony implementation</h2>\n<p>Now let’s see how to implement this tracking flow using the Symfony framework.</p>\n<p>Notice that you should have your own logic to generate emails, to store and send them. I will not cover these parts, but only the one related to the tracking flow explained before.</p>\n<p>First of all, we want to have a dedicated <code class=\"language-text\">Response</code> class to send back a transparent pixel to the client, let’s call it <code class=\"language-text\">TransparentPixelResponse</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\">\n      <pre class=\"language-php\"><code class=\"language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token package\">LMammino<span class=\"token punctuation\">\\</span>Http</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>HttpFoundation<span class=\"token punctuation\">\\</span>Response</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * Class TransparentPixelResponse\n * @package LMammino\\Http\n * @author Luciano Mammino &lt;lucianomammino@gmail.com>\n */</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TransparentPixelResponse</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Response</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/**\n     * Base 64 encoded contents for 1px transparent gif and png\n     * @var string\n     */</span>\n    <span class=\"token keyword\">const</span> <span class=\"token constant\">IMAGE_CONTENT</span> <span class=\"token operator\">=</span>\n        <span class=\"token single-quoted-string string\">'R0lGODlhAQABAJAAAP8AAAAAACH5BAUQAAAALAAAAAABAAEAAAICBAEAOw=='</span>\n    <span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * The response content type\n     * @var string\n     */</span>\n    <span class=\"token keyword\">const</span> <span class=\"token constant\">CONTENT_TYPE</span> <span class=\"token operator\">=</span> <span class=\"token single-quoted-string string\">'image/gif'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n     * Constructor\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token variable\">$content</span> <span class=\"token operator\">=</span> <span class=\"token function\">base64_decode</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">IMAGE_CONTENT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">parent</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">__construct</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$content</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">headers</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'Content-Type'</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">CONTENT_TYPE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">setPrivate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">headers</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">addCacheControlDirective</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'no-cache'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">headers</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">addCacheControlDirective</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'must-revalidate'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>The logic is very simple here. We have hardcoded the content of a 1x1 transparent gif image using a base64 encoded string.\nWe use this string to set the content of the response object. We also set some cache headers to mark the response as not cacheable.</p>\n<p>Now we can write a controller that will handle the tracking request:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\">\n      <pre class=\"language-php\"><code class=\"language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Bundle<span class=\"token punctuation\">\\</span>FrameworkBundle<span class=\"token punctuation\">\\</span>Controller<span class=\"token punctuation\">\\</span>Controller</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>HttpFoundation<span class=\"token punctuation\">\\</span>Request</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Sensio<span class=\"token punctuation\">\\</span>Bundle<span class=\"token punctuation\">\\</span>FrameworkExtraBundle<span class=\"token punctuation\">\\</span>Configuration<span class=\"token punctuation\">\\</span>Route</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">LMammino<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>TransparentPixelResponse</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TrackingController</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Controller</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">/**\n     * @Route('/track.gif')\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">trackEmailAction</span><span class=\"token punctuation\">(</span>Request <span class=\"token variable\">$request</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n    \t<span class=\"token variable\">$id</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$request</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">query</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span> <span class=\"token operator\">!==</span> <span class=\"token variable\">$id</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">//... executes some logic to retrieve the email and mark it as opened</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TransparentPixelResponse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>Here the logic is pretty simple too.\nWe created a controller with a <code class=\"language-text\">trackEmail</code> action. The action has been assigned to the route <code class=\"language-text\">/track.gif</code> using the <code class=\"language-text\">Route</code> annotation (if you prefer you can do it also by using the yaml or the xml convention).\nWithin this action we just read the parameter <code class=\"language-text\">id</code> from the request and used it to execute the persistence logic to retrive the email record and mark it as opened (skipped in the example).\nThen we just have to return a new instance of our <code class=\"language-text\">TransparentPixelResponse</code> class.</p>\n<p>That’s it! Pretty simple, isn’t it?</p>\n<h3 id=\"improve-performance\"><a href=\"#improve-performance\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Improve performance</h3>\n<p><strong>UPDATE 2014-06-16</strong>: A comment from <a href=\"http://disqus.com/Lumbendil\">Lumbendil</a> pointed out that it would be possible to do the “heavy logic” within a <code class=\"language-text\">kernel.terminate</code> event listener. So let’s refactor our code to follow this good suggestion:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\">\n      <pre class=\"language-php\"><code class=\"language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Bundle<span class=\"token punctuation\">\\</span>FrameworkBundle<span class=\"token punctuation\">\\</span>Controller<span class=\"token punctuation\">\\</span>Controller</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>HttpKernel<span class=\"token punctuation\">\\</span>Event<span class=\"token punctuation\">\\</span>KernelEvent</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>HttpKernel<span class=\"token punctuation\">\\</span>KernelEvents</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Symfony<span class=\"token punctuation\">\\</span>Component<span class=\"token punctuation\">\\</span>HttpFoundation<span class=\"token punctuation\">\\</span>Request</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token package\">Sensio<span class=\"token punctuation\">\\</span>Bundle<span class=\"token punctuation\">\\</span>FrameworkExtraBundle<span class=\"token punctuation\">\\</span>Configuration<span class=\"token punctuation\">\\</span>Route</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> <span class=\"token package\">LMammino<span class=\"token punctuation\">\\</span>Http<span class=\"token punctuation\">\\</span>TransparentPixelResponse</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">TrackingController</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Controller</span>\n<span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">/**\n     * @Route('/track.gif')\n     */</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">trackEmailAction</span><span class=\"token punctuation\">(</span>Request <span class=\"token variable\">$request</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n    \t<span class=\"token variable\">$id</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$request</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">query</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span> <span class=\"token operator\">!==</span> <span class=\"token variable\">$id</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        \t<span class=\"token variable\">$dispatcher</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'event_dispatcher'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token variable\">$dispatcher</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">addListener</span><span class=\"token punctuation\">(</span>KernelEvents<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token constant\">TERMINATE</span><span class=\"token punctuation\">,</span>\n                <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>KernelEvent <span class=\"token variable\">$event</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">use</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$id</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                   <span class=\"token comment\">//... executes some logic to retrieve</span>\n                   <span class=\"token comment\">// the email and mark it as opened</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TransparentPixelResponse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>Notice that we have “wrapped” our potentially heavy logic within a callable function that gets executed when the <a href=\"http://symfony.com/doc/current/components/http_kernel/introduction.html#component-http-kernel-kernel-terminate\"><code class=\"language-text\">kernel.terminate</code></a> event is fired. This way the response is returned immediatly (before executing all the heavy logic) and the requesting client will not have to wait for processing.</p>\n<p>Obviously, from the point of view of the server, we are not “really” improving performance. The code is not executed faster, but only in a different order. There’s only an apparent performance improvement for the web client who receives the response quicker and doesn’t care about the processing logic that will keep running on the server side.</p>\n<p>Keep in mind that the <code class=\"language-text\">kernel.terminate</code> event is optional, and should only be called if your kernel implements <code class=\"language-text\">TerminableInterface</code> (it should work if you are using the Symfony Standard Edition).</p>\n<p><a href=\"http://disqus.com/Lumbendil\">Lumbendil</a> also pointed out that this solution is not the only one possible. You can also rely on some messaging/queue system such as <a href=\"http://www.rabbitmq.com\">RabbitMq</a>, <a href=\"http://gearman.org\">Gearman</a> or <a href=\"http://kr.github.io/beanstalkd\">Beanstalkd</a>. These are great tools but they add new dependencies and a whole new layer of complexity to the web infrastructure, so I will suggest to use one of them only if your logic is very complex or heavy (or if you are designing you whole infrastructure from scratch to leverage a work queue system).</p>\n<h2 id=\"considerations\"><a href=\"#considerations\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Considerations</h2>\n<p>You can apply this method to track email opening or views on other online contents such as Html webpages (in cases where you can’t or don’t want to use javascript).\nAnyway, regarding tracking email opening, you should be aware that <strong>some e-mail clients block images loading</strong> when you open an e-mail from an unknown sender. Yes, they do it not only to save your bandwidth, but mostly to avoid triggering tracking images! So in this cases you will not able to track the email opening, unless the user authorizes its client to load all the images in that specific email.</p>\n<p><strong>UPDATE 2014-06-17</strong>: <a href=\"http://disqus.com/jeltesteijaert/\">Jelte Steijaert</a> reported that using email authentication systems such as <a href=\"http://www.dkim.org/\">DKIM</a> or <a href=\"http://www.openspf.org/\">SPF</a> will increase chances for images to get autoloaded by email clients. This authentication methods are also very useful to save your emails from ending up into the spam folder, so they are very recommended!</p>\n<p>If you have some other consideration you are very welcome to write a comment, as always!</p>","frontmatter":{"title":"Transparent pixel response with Symfony, how to track email opening","slug":"transparent-pixel-response-with-symfony-how-to-track-email-opening","author":"Luciano Mammino","tags":["php","symfony","http","tracking","email"],"date":"June 13, 2014","header_img":{"publicURL":"/static/transparent-pixel-response-with-symfony-how-to-track-email-opening-acd6bcc08670aa3afeb2e66f58deae5f.jpg"}}}},"pageContext":{"slug":"transparent-pixel-response-with-symfony-how-to-track-email-opening","width":440,"height":220,"type":"twitter"}}